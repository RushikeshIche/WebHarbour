<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Product - WebHarbour</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-anchor text-blue-600 text-2xl"></i>
                    <a href="../index.html" class="text-2xl font-bold text-gray-800">WebHarbour</a>
                </div>

                <div class="hidden md:flex space-x-6">
                    <a href="../index.html" class="text-gray-600 hover:text-blue-600">Home</a>
                    <a href="marketplace.html" class="text-gray-600 hover:text-blue-600">Marketplace</a>
                    <a href="upload.html" class="text-blue-600 font-semibold">Upload</a>
                    <a href="dashboard.html" class="text-gray-600 hover:text-blue-600">Dashboard</a>
                </div>

                <div class="flex items-center space-x-4">
                    <div id="auth-buttons">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Upload Container -->
    <div class="container mx-auto px-4 py-8">
        <div id="upload-container">
            <!-- Developer access required message will be shown here if needed -->
        </div>

        <!-- Upload Form (Initially hidden, shown after auth check) -->
        <div id="upload-form-container" class="hidden">
            <!-- Progress Steps -->
            <div class="mb-8">
                <div class="flex items-center justify-center">
                    <div class="flex items-center">
                        <div class="step active">
                            <div class="step-number">1</div>
                            <div class="step-label">Basic Info</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-label">Files</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-label">Pricing</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step">
                            <div class="step-number">4</div>
                            <div class="step-label">Review</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Multi-step Form -->
            <form id="upload-form" onsubmit="handleUploadSubmit(event)">
                <!-- Step 1: Basic Information -->
                <div id="step-1" class="step-content active">
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-6">Product Information</h2>

                        <div class="mb-6">
                            <label class="form-label">Product Title *</label>
                            <input type="text" id="title" class="form-input"
                                placeholder="Enter a descriptive title for your product" required>
                            <p class="text-sm text-gray-600 mt-1">Be descriptive and clear about what your product does.
                            </p>
                        </div>

                        <div class="mb-6">
                            <label class="form-label">Category *</label>
                            <select id="category" class="form-input" required>
                                <option value="">Select a category</option>
                                <option value="app">Mobile App</option>
                                <option value="game">Game</option>
                                <option value="software">Software</option>
                                <option value="pdf">PDF Document</option>
                                <option value="movie">Movie/Video</option>
                            </select>
                        </div>

                        <div class="mb-6">
                            <label class="form-label">Description *</label>
                            <textarea id="description" class="form-input" rows="6"
                                placeholder="Describe your product in detail. Include features, benefits, and any important information for users."
                                required></textarea>
                            <p class="text-sm text-gray-600 mt-1">Minimum 200 characters. Be detailed and honest about
                                your product.</p>
                        </div>

                        <div class="mb-6">
                            <label class="form-label">Tags</label>
                            <input type="text" id="tags" class="form-input"
                                placeholder="Add tags separated by commas (e.g., productivity, mobile, business)">
                            <p class="text-sm text-gray-600 mt-1">Tags help users discover your product.</p>
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <button type="button" onclick="nextStep(2)" class="btn btn-primary px-8">
                            Next: Files <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Files -->
                <div id="step-2" class="step-content hidden">
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-6">Upload Files</h2>

                        <!-- Main File Upload -->
                        <div class="mb-8">
                            <label class="form-label">Main File *</label>
                            <p class="text-sm text-gray-600 mb-4">
                                Upload the main file that users will download after purchase.
                                Max file size: 100MB
                            </p>

                            <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                                <p class="mb-4">Drag and drop your file here, or click to browse</p>
                                <input type="file" id="file-upload" class="hidden" onchange="handleFileUpload(event)">
                                <label for="file-upload" class="btn btn-outline cursor-pointer">
                                    <i class="fas fa-folder-open mr-2"></i> Choose File
                                </label>

                                <div id="file-info" class="mt-4 hidden">
                                    <p class="font-semibold" id="file-name">No file chosen</p>
                                    <p class="text-sm text-gray-600" id="file-size"></p>
                                    <button type="button" onclick="removeFile()"
                                        class="text-red-600 hover:text-red-800 text-sm mt-2">
                                        <i class="fas fa-times mr-1"></i> Remove file
                                    </button>
                                </div>
                            </div>

                            <div class="mt-4 text-sm text-gray-600">
                                <p><strong>Allowed file types by category:</strong></p>
                                <ul class="list-disc pl-5 mt-2">
                                    <li><strong>Mobile Apps:</strong> .apk, .ipa, .exe, .dmg</li>
                                    <li><strong>Games:</strong> .exe, .dmg, .zip, .rar</li>
                                    <li><strong>Software:</strong> .exe, .dmg, .msi, .deb, .rpm</li>
                                    <li><strong>PDFs:</strong> .pdf</li>
                                    <li><strong>Movies:</strong> .mp4, .avi, .mkv, .mov, .wmv</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Thumbnail Upload -->
                        <div class="mb-8">
                            <label class="form-label">Thumbnail Image *</label>
                            <p class="text-sm text-gray-600 mb-4">
                                Upload a thumbnail image that represents your product.
                                Recommended size: 1280x720px. Max file size: 5MB
                            </p>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center">
                                    <i class="fas fa-image text-3xl text-gray-400 mb-4"></i>
                                    <p class="mb-4">Upload thumbnail</p>
                                    <input type="file" id="thumbnail-upload" class="hidden" accept="image/*"
                                        onchange="handleThumbnailUpload(event)">
                                    <label for="thumbnail-upload" class="btn btn-outline cursor-pointer">
                                        Choose Image
                                    </label>
                                </div>

                                <div>
                                    <div id="thumbnail-preview" class="border rounded-xl p-4 text-center h-full">
                                        <p class="text-gray-500">No thumbnail uploaded</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Screenshots Upload -->
                        <div class="mb-6">
                            <label class="form-label">Screenshots (Optional)</label>
                            <p class="text-sm text-gray-600 mb-4">
                                Upload up to 10 screenshots to showcase your product.
                                Max file size per image: 5MB
                            </p>

                            <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center mb-4">
                                <i class="fas fa-images text-3xl text-gray-400 mb-4"></i>
                                <p class="mb-4">Upload screenshots</p>
                                <input type="file" id="screenshots-upload" class="hidden" accept="image/*" multiple
                                    onchange="handleScreenshotsUpload(event)">
                                <label for="screenshots-upload" class="btn btn-outline cursor-pointer">
                                    <i class="fas fa-plus mr-2"></i> Add Screenshots
                                </label>
                            </div>

                            <div id="screenshots-preview" class="grid grid-cols-2 md:grid-cols-5 gap-4">
                                <!-- Screenshot previews will be added here -->
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button type="button" onclick="prevStep(1)" class="btn btn-outline px-8">
                            <i class="fas fa-arrow-left mr-2"></i> Back
                        </button>
                        <button type="button" onclick="nextStep(3)" class="btn btn-primary px-8">
                            Next: Pricing <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Pricing & Details -->
                <div id="step-3" class="step-content hidden">
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-6">Pricing & Details</h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <!-- Price -->
                            <div>
                                <label class="form-label">Price (USD) *</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-gray-600">$</span>
                                    <input type="number" id="price" class="form-input pl-8" placeholder="0.00" min="0"
                                        step="0.01" required>
                                </div>
                            </div>

                            <!-- Discount Price -->
                            <div>
                                <label class="form-label">Discount Price (Optional)</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-gray-600">$</span>
                                    <input type="number" id="discount-price" class="form-input pl-8" placeholder="0.00"
                                        min="0" step="0.01">
                                </div>
                                <p class="text-sm text-gray-600 mt-1">Set a discounted price for promotions.</p>
                            </div>
                        </div>

                        <!-- License Type -->
                        <div class="mb-6">
                            <label class="form-label">License Type *</label>
                            <select id="license" class="form-input">
                                <option value="paid">Paid License</option>
                                <option value="free">Free</option>
                                <option value="freemium">Freemium</option>
                                <option value="subscription">Subscription</option>
                            </select>
                        </div>

                        <!-- Version -->
                        <div class="mb-6">
                            <label class="form-label">Version *</label>
                            <input type="text" id="version" class="form-input" placeholder="1.0.0" value="1.0.0"
                                required>
                            <p class="text-sm text-gray-600 mt-1">Use semantic versioning (e.g., 1.2.3)</p>
                        </div>

                        <!-- System Requirements -->
                        <div class="mb-6">
                            <label class="form-label">System Requirements</label>
                            <textarea id="requirements" class="form-input" rows="4" placeholder="List the system requirements for your product. For example:
• Operating System: Windows 10 or later
• RAM: 4GB minimum
• Storage: 500MB free space
• Other requirements..."></textarea>
                        </div>

                        <!-- Compatibility -->
                        <div class="mb-6">
                            <label class="form-label">Compatibility Information</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Operating System</label>
                                    <input type="text" id="os" class="form-input"
                                        placeholder="e.g., Windows, macOS, Linux">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Browser</label>
                                    <input type="text" id="browser" class="form-input"
                                        placeholder="e.g., Chrome, Firefox, Safari">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Minimum RAM</label>
                                    <input type="text" id="ram" class="form-input" placeholder="e.g., 4GB">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Processor</label>
                                    <input type="text" id="processor" class="form-input"
                                        placeholder="e.g., Intel i5 or equivalent">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button type="button" onclick="prevStep(2)" class="btn btn-outline px-8">
                            <i class="fas fa-arrow-left mr-2"></i> Back
                        </button>
                        <button type="button" onclick="nextStep(4)" class="btn btn-primary px-8">
                            Next: Review <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 4: Review & Submit -->
                <div id="step-4" class="step-content hidden">
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-6">Review & Submit</h2>

                        <!-- Product Preview -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold mb-4">Product Preview</h3>
                            <div class="border rounded-xl p-6">
                                <div class="flex items-start space-x-6">
                                    <div id="review-thumbnail"
                                        class="w-32 h-32 bg-gray-200 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-image text-gray-400 text-3xl"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 id="review-title" class="text-xl font-bold mb-2">Product Title</h4>
                                        <p id="review-category" class="text-gray-600 mb-3">Category</p>
                                        <p id="review-description" class="text-gray-700 mb-4">Product description will
                                            appear here...</p>
                                        <div class="flex items-center space-x-4">
                                            <span id="review-price"
                                                class="text-2xl font-bold text-green-600">$0.00</span>
                                            <span id="review-discount"
                                                class="text-lg text-gray-500 line-through hidden">$0.00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Upload Terms -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold mb-4">Upload Terms</h3>
                            <div class="bg-gray-50 rounded-xl p-6">
                                <div class="space-y-4">
                                    <div class="flex items-start">
                                        <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                        <div>
                                            <p class="font-medium">Manual Review</p>
                                            <p class="text-sm text-gray-600">All products go through manual review
                                                before being published. This process usually takes 24-48 hours.</p>
                                        </div>
                                    </div>

                                    <div class="flex items-start">
                                        <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                        <div>
                                            <p class="font-medium">Quality Standards</p>
                                            <p class="text-sm text-gray-600">Your product must meet our quality
                                                standards. Low-quality or malicious content will be rejected.</p>
                                        </div>
                                    </div>

                                    <div class="flex items-start">
                                        <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                        <div>
                                            <p class="font-medium">Revenue Share</p>
                                            <p class="text-sm text-gray-600">Developers receive 70% of the sale price.
                                                WebHarbour takes 30% for platform maintenance and services.</p>
                                        </div>
                                    </div>

                                    <div class="flex items-start">
                                        <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                        <div>
                                            <p class="font-medium">Legal Compliance</p>
                                            <p class="text-sm text-gray-600">You must own all rights to the content you
                                                upload. Uploading copyrighted material without permission is prohibited.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-6">
                                    <label class="flex items-start">
                                        <input type="checkbox" id="agree-terms" class="mt-1 mr-3" required>
                                        <span class="text-sm">
                                            I agree to the <a href="#" class="text-blue-600 hover:underline">Terms of
                                                Service</a> and confirm that I have the right to distribute this
                                            product. I understand that all products are subject to manual review and may
                                            be rejected if they don't meet quality standards.
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Final Actions -->
                        <div class="flex items-center justify-between p-4 bg-blue-50 rounded-xl">
                            <div>
                                <p class="font-medium">Ready to submit your product?</p>
                                <p class="text-sm text-gray-600">After submission, our team will review it within 24-48
                                    hours.</p>
                            </div>
                            <div>
                                <button type="submit" id="submit-btn" class="btn btn-success px-8 py-3">
                                    <i class="fas fa-paper-plane mr-2"></i> Submit for Review
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button type="button" onclick="prevStep(3)" class="btn btn-outline px-8">
                            <i class="fas fa-arrow-left mr-2"></i> Back
                        </button>
                        <button type="button" onclick="saveAsDraft()" class="btn btn-secondary px-8">
                            <i class="fas fa-save mr-2"></i> Save as Draft
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12 mt-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <i class="fas fa-anchor text-blue-400 text-2xl"></i>
                        <span class="text-2xl font-bold">WebHarbour</span>
                    </div>
                    <p class="text-gray-400">Your trusted digital marketplace.</p>
                </div>
                <!-- Footer links -->
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2024 WebHarbour. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/upload.js"></script>

    <style>
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e7eb;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: #3b82f6;
            color: white;
        }

        .step.completed .step-number {
            background: #10b981;
            color: white;
        }

        .step-label {
            font-size: 14px;
            color: #6b7280;
        }

        .step.active .step-label {
            color: #3b82f6;
            font-weight: 500;
        }

        .step-line {
            width: 100px;
            height: 2px;
            background: #e5e7eb;
            margin: 0 10px;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <script>
        // Upload page specific JavaScript
        let currentStep = 1;
        let uploadedFiles = {
            mainFile: null,
            thumbnail: null,
            screenshots: []
        };

        function nextStep(step) {
            // Validate current step
            if (!validateStep(currentStep)) {
                return;
            }

            // Hide current step
            document.getElementById(`step-${currentStep}`).classList.remove('active');
            document.querySelectorAll('.step')[currentStep - 1].classList.remove('active');

            // Show next step
            currentStep = step;
            document.getElementById(`step-${currentStep}`).classList.add('active');
            document.querySelectorAll('.step')[currentStep - 1].classList.add('active');

            // Update progress bar
            updateProgressBar();

            // If moving to review step, update preview
            if (step === 4) {
                updateReviewPreview();
            }
        }

        function prevStep(step) {
            // Hide current step
            document.getElementById(`step-${currentStep}`).classList.remove('active');
            document.querySelectorAll('.step')[currentStep - 1].classList.remove('active');

            // Show previous step
            currentStep = step;
            document.getElementById(`step-${currentStep}`).classList.add('active');
            document.querySelectorAll('.step')[currentStep - 1].classList.add('active');

            // Update progress bar
            updateProgressBar();
        }

        function validateStep(step) {
            switch (step) {
                case 1:
                    const title = document.getElementById('title').value.trim();
                    const category = document.getElementById('category').value;
                    const description = document.getElementById('description').value.trim();

                    if (!title) {
                        Utils.showAlert('Please enter a product title', 'error');
                        return false;
                    }

                    if (!category) {
                        Utils.showAlert('Please select a category', 'error');
                        return false;
                    }

                    if (!description || description.length < 200) {
                        Utils.showAlert('Description must be at least 200 characters', 'error');
                        return false;
                    }

                    return true;

                case 2:
                    if (!uploadedFiles.mainFile) {
                        Utils.showAlert('Please upload the main file', 'error');
                        return false;
                    }

                    if (!uploadedFiles.thumbnail) {
                        Utils.showAlert('Please upload a thumbnail image', 'error');
                        return false;
                    }

                    return true;

                case 3:
                    const price = document.getElementById('price').value;
                    const version = document.getElementById('version').value.trim();

                    if (!price || parseFloat(price) < 0) {
                        Utils.showAlert('Please enter a valid price', 'error');
                        return false;
                    }

                    if (!version) {
                        Utils.showAlert('Please enter a version number', 'error');
                        return false;
                    }

                    return true;

                default:
                    return true;
            }
        }

        function updateProgressBar() {
            const steps = document.querySelectorAll('.step');
            steps.forEach((step, index) => {
                if (index < currentStep - 1) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (index === currentStep - 1) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file size (100MB max)
            if (file.size > 100 * 1024 * 1024) {
                Utils.showAlert('File size must be less than 100MB', 'error');
                event.target.value = '';
                return;
            }

            uploadedFiles.mainFile = file;

            // Update UI
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-size').textContent = Utils.formatFileSize(file.size);
            document.getElementById('file-info').classList.remove('hidden');
        }

        function removeFile() {
            uploadedFiles.mainFile = null;
            document.getElementById('file-upload').value = '';
            document.getElementById('file-name').textContent = 'No file chosen';
            document.getElementById('file-size').textContent = '';
            document.getElementById('file-info').classList.add('hidden');
        }

        function handleThumbnailUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate image
            if (!file.type.startsWith('image/')) {
                Utils.showAlert('Please upload an image file', 'error');
                event.target.value = '';
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                Utils.showAlert('Image must be less than 5MB', 'error');
                event.target.value = '';
                return;
            }

            uploadedFiles.thumbnail = file;

            // Preview thumbnail
            const reader = new FileReader();
            reader.onload = function (e) {
                const preview = document.getElementById('thumbnail-preview');
                preview.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover rounded-lg">`;
            };
            reader.readAsDataURL(file);
        }

        function handleScreenshotsUpload(event) {
            const files = Array.from(event.target.files);

            // Validate files
            const validFiles = files.filter(file => {
                if (!file.type.startsWith('image/')) {
                    Utils.showAlert(`${file.name} is not an image file`, 'warning');
                    return false;
                }
                if (file.size > 5 * 1024 * 1024) {
                    Utils.showAlert(`${file.name} is too large (max 5MB)`, 'warning');
                    return false;
                }
                return true;
            });

            // Add to uploaded files (max 10)
            const remainingSlots = 10 - uploadedFiles.screenshots.length;
            const filesToAdd = validFiles.slice(0, remainingSlots);

            uploadedFiles.screenshots.push(...filesToAdd);
            updateScreenshotsPreview();

            if (validFiles.length > remainingSlots) {
                Utils.showAlert(`Maximum 10 screenshots allowed. ${remainingSlots} added.`, 'warning');
            }

            event.target.value = '';
        }

        function updateScreenshotsPreview() {
            const container = document.getElementById('screenshots-preview');
            if (!container) return;

            if (uploadedFiles.screenshots.length === 0) {
                container.innerHTML = '<p class="text-gray-500 col-span-full text-center py-4">No screenshots uploaded</p>';
                return;
            }

            const previews = uploadedFiles.screenshots.map((file, index) => {
                const url = URL.createObjectURL(file);
                return `
                    <div class="relative">
                        <img src="${url}" 
                             class="w-full h-32 object-cover rounded-lg">
                        <button type="button" onclick="removeScreenshot(${index})" 
                                class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center">
                            <i class="fas fa-times text-xs"></i>
                        </button>
                    </div>
                `;
            }).join('');

            container.innerHTML = previews;
        }

        function removeScreenshot(index) {
            uploadedFiles.screenshots.splice(index, 1);
            updateScreenshotsPreview();
        }

        function updateReviewPreview() {
            // Update title
            const title = document.getElementById('title').value;
            document.getElementById('review-title').textContent = title || 'Product Title';

            // Update category
            const category = document.getElementById('category').value;
            const categoryNames = {
                'app': 'Mobile App',
                'game': 'Game',
                'software': 'Software',
                'pdf': 'PDF Document',
                'movie': 'Movie/Video'
            };
            document.getElementById('review-category').textContent = categoryNames[category] || 'Category';

            // Update description
            const description = document.getElementById('description').value;
            document.getElementById('review-description').textContent = description || 'Product description will appear here...';

            // Update price
            const price = parseFloat(document.getElementById('price').value) || 0;
            const discountPrice = document.getElementById('discount-price').value ?
                parseFloat(document.getElementById('discount-price').value) : null;

            if (discountPrice) {
                document.getElementById('review-price').textContent = `$${discountPrice.toFixed(2)}`;
                document.getElementById('review-discount').textContent = `$${price.toFixed(2)}`;
                document.getElementById('review-discount').classList.remove('hidden');
            } else {
                document.getElementById('review-price').textContent = `$${price.toFixed(2)}`;
                document.getElementById('review-discount').classList.add('hidden');
            }

            // Update thumbnail preview
            if (uploadedFiles.thumbnail) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('review-thumbnail').innerHTML =
                        `<img src="${e.target.result}" class="w-full h-full object-cover rounded-lg">`;
                };
                reader.readAsDataURL(uploadedFiles.thumbnail);
            }
        }

        async function handleUploadSubmit(event) {
            event.preventDefault();

            if (!validateStep(4)) {
                Utils.showAlert('Please complete all required fields', 'error');
                return;
            }

            if (!document.getElementById('agree-terms').checked) {
                Utils.showAlert('You must agree to the terms and conditions', 'error');
                return;
            }

            try {
                // Disable submit button
                const submitBtn = document.getElementById('submit-btn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<div class="spinner spinner-sm mr-2"></div> Submitting...';

                // Get form data
                const formData = {
                    title: document.getElementById('title').value.trim(),
                    description: document.getElementById('description').value.trim(),
                    category: document.getElementById('category').value,
                    price: parseFloat(document.getElementById('price').value),
                    discountPrice: document.getElementById('discount-price').value ?
                        parseFloat(document.getElementById('discount-price').value) : undefined,
                    version: document.getElementById('version').value.trim(),
                    license: document.getElementById('license').value,
                    tags: document.getElementById('tags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                    compatibility: {
                        os: document.getElementById('os').value.trim(),
                        browser: document.getElementById('browser').value.trim(),
                        minRam: document.getElementById('ram').value.trim(),
                        processor: document.getElementById('processor').value.trim()
                    },
                    systemRequirements: document.getElementById('requirements').value.trim()
                };

                // Upload files first
                const category = formData.category;

                // Upload main file
                const fileUpload = await UploadAPI.uploadFile(uploadedFiles.mainFile, category);

                // Upload thumbnail
                const thumbnailUrl = await UploadAPI.uploadThumbnail(uploadedFiles.thumbnail);

                // Upload screenshots if any
                let screenshotUrls = [];
                if (uploadedFiles.screenshots.length > 0) {
                    screenshotUrls = await UploadAPI.uploadScreenshots(uploadedFiles.screenshots);
                }

                // Add file URLs to form data
                formData.fileUrl = fileUpload.fileUrl;
                formData.fileSize = uploadedFiles.mainFile.size;
                formData.thumbnail = thumbnailUrl;
                formData.screenshots = screenshotUrls;

                // Submit product
                const product = await UploadAPI.submitProduct(formData);

                // Show success message
                Utils.showAlert('Product submitted successfully! It will be reviewed by our team.', 'success');

                // Reset form
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);

            } catch (error) {
                // Re-enable submit button
                const submitBtn = document.getElementById('submit-btn');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> Submit for Review';

                // Error already shown by UploadAPI functions
            }
        }

        function saveAsDraft() {
            // TODO: Implement save as draft functionality
            Utils.showAlert('Draft saved successfully!', 'success');
        }

        // Initialize upload page
        document.addEventListener('DOMContentLoaded', function () {
            // Check if user is logged in and is developer/admin
            const user = Auth.getUser();
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            if (!Auth.isDeveloper()) {
                document.getElementById('upload-container').innerHTML = `
                    <div class="max-w-2xl mx-auto text-center py-12">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-5xl mb-6"></i>
                        <h2 class="text-2xl font-bold mb-4">Developer Account Required</h2>
                        <p class="text-gray-600 mb-6">You need a developer account to upload products. Developer accounts can upload and sell products on WebHarbour.</p>
                        <div class="space-x-4">
                            <button onclick="requestDeveloperAccess()" class="btn btn-primary px-6">
                                Request Developer Access
                            </button>
                            <a href="marketplace.html" class="btn btn-outline px-6">
                                Browse Marketplace
                            </a>
                        </div>
                    </div>
                `;
                return;
            }

            // Show upload form
            document.getElementById('upload-form-container').classList.remove('hidden');

            // Initialize progress bar
            updateProgressBar();
        });

        function requestDeveloperAccess() {
            // TODO: Implement developer access request
            Utils.showAlert('Developer access request sent to admin!', 'success');
            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 2000);
        }

        // Expose functions to window
        window.nextStep = nextStep;
        window.prevStep = prevStep;
        window.handleFileUpload = handleFileUpload;
        window.removeFile = removeFile;
        window.handleThumbnailUpload = handleThumbnailUpload;
        window.handleScreenshotsUpload = handleScreenshotsUpload;
        window.removeScreenshot = removeScreenshot;
        window.handleUploadSubmit = handleUploadSubmit;
        window.saveAsDraft = saveAsDraft;
        window.requestDeveloperAccess = requestDeveloperAccess;
    </script>
</body>

</html>